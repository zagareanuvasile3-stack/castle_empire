<!DOCTYPE html>

<html lang="ru">

<head>

    <meta charset="UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <title>Castle Empire</title>

    <script src="https://telegram.org/js/telegram-web-app.js"></script>

    <style>

        /* –ü–æ–ª–Ω—ã–π CSS —Å—Ç–∏–ª—å —Å —É–ª—É—á—à–µ–Ω–Ω—ã–º –¥–∏–∑–∞–π–Ω–æ–º */

        * {

            box-sizing: border-box;

            margin: 0;

            padding: 0;

            -webkit-tap-highlight-color: transparent;

        }

        

        body {

            background: linear-gradient(135deg, #0b2b40 0%, #093145 100%);

            color: white;

            font-family: 'Segoe UI', Roboto, sans-serif;

            padding: 15px;

            min-height: 100vh;

        }

        

        .container {

            max-width: 100%;

            margin: 0 auto;

        }

        

        .header {

            text-align: center;

            margin-bottom: 20px;

            padding: 15px;

            background: rgba(25, 55, 75, 0.6);

            border-radius: 16px;

            border: 1px solid rgba(42, 150, 165, 0.3);

        }

        

        .game-title {

            font-size: 24px;

            font-weight: bold;

            color: #ff9d00;

            margin-bottom: 5px;

        }

        

        .resources-grid {

            display: grid;

            grid-template-columns: repeat(2, 1fr);

            gap: 10px;

            margin-bottom: 20px;

        }

        

        .resource-card {

            background: linear-gradient(135deg, #15616b 0%, #093145 100%);

            padding: 12px;

            border-radius: 12px;

            display: flex;

            align-items: center;

            gap: 10px;

            box-shadow: 0 3px 10px rgba(0,0,0,0.2);

        }

        

        .resource-icon {

            width: 35px;

            height: 35px;

            border-radius: 50%;

            background: linear-gradient(135deg, #ff9d00 0%, #ff7800 100%);

            display: flex;

            align-items: center;

            justify-content: center;

            font-size: 18px;

        }

        

        .resource-info {

            flex: 1;

        }

        

        .resource-name {

            font-size: 12px;

            opacity: 0.8;

        }

        

        .resource-amount {

            font-weight: bold;

            font-size: 16px;

        }

        

        .buildings-grid {

            display: grid;

            grid-template-columns: repeat(2, 1fr);

            gap: 15px;

            margin-bottom: 20px;

        }

        

        .building-card {

            background: linear-gradient(135deg, #1e5f75 0%, #164b60 100%);

            border-radius: 14px;

            padding: 18px 12px;

            text-align: center;

            border: 2px solid rgba(42, 150, 165, 0.3);

        }

        

        .building-icon {

            font-size: 36px;

            margin-bottom: 8px;

            display: block;

        }

        

        .building-name {

            font-weight: bold;

            font-size: 15px;

            margin-bottom: 5px;

        }

        

        .building-level {

            background: rgba(0,0,0,0.3);

            padding: 3px 10px;

            border-radius: 15px;

            font-size: 12px;

            display: inline-block;

            margin-bottom: 5px;

        }

        

        .building-production {

            font-size: 11px;

            opacity: 0.8;

        }

        

        .timer-status {

            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);

            color: white;

            padding: 12px;

            border-radius: 12px;

            text-align: center;

            margin-bottom: 10px;

            font-weight: bold;

        }

        

        .timer-status.ready {

            background: linear-gradient(135deg, #00b894 0%, #00a085 100%);

        }

        

        .collection-info {

            font-size: 12px;

            opacity: 0.8;

            text-align: center;

            margin-bottom: 15px;

        }

        

        .actions-bar {

            display: grid;

            grid-template-columns: repeat(2, 1fr);

            gap: 10px;

            margin-bottom: 15px;

        }

        

        .action-btn {

            background: linear-gradient(135deg, #ff9d00 0%, #ff7800 100%);

            color: #093145;

            border: none;

            padding: 14px 10px;

            border-radius: 12px;

            font-weight: bold;

            font-size: 14px;

            cursor: pointer;

            display: flex;

            flex-direction: column;

            align-items: center;

            gap: 4px;

            box-shadow: 0 3px 8px rgba(255, 157, 0, 0.3);

        }

        

        .action-btn:disabled {

            opacity: 0.6;

            cursor: not-allowed;

        }

        

        .action-btn:active:not(:disabled) {

            transform: scale(0.97);

        }

        

        .btn-icon {

            font-size: 20px;

        }

        

        .status-bar {

            background: rgba(25, 55, 75, 0.7);

            padding: 10px;

            border-radius: 10px;

            text-align: center;

            font-size: 13px;

            margin-top: 10px;

        }

        

        .upgrade-menu {

            display: none;

            position: fixed;

            top: 50%;

            left: 50%;

            transform: translate(-50%, -50%);

            background: linear-gradient(135deg, #1e5f75 0%, #164b60 100%);

            padding: 20px;

            border-radius: 16px;

            z-index: 1000;

            width: 90%;

            max-width: 400px;

            box-shadow: 0 10px 30px rgba(0,0,0,0.5);

        }

        

        .overlay {

            display: none;

            position: fixed;

            top: 0;

            left: 0;

            width: 100%;

            height: 100%;

            background: rgba(0,0,0,0.7);

            z-index: 999;

        }

    </style>

</head>

<body>

    <div class="container">

        <div class="header">

            <div class="game-title">üè∞ Castle Empire</div>

            <div>–†–∞–∑–≤–∏–≤–∞–π—Ç–µ —Å–≤–æ–µ –∫–æ—Ä–æ–ª–µ–≤—Å—Ç–≤–æ!</div>

        </div>

        

        <div class="resources-grid">

            <div class="resource-card">

                <div class="resource-icon">üíé</div>

                <div class="resource-info">

                    <div class="resource-name">–ê–õ–ú–ê–ó–´</div>

                    <div class="resource-amount" id="gems-count">5.0</div>

                </div>

            </div>

            

            <div class="resource-card">

                <div class="resource-icon">üåæ</div>

                <div class="resource-info">

                    <div class="resource-name">–ï–î–ê</div>

                    <div class="resource-amount" id="food-count">120</div>

                </div>

            </div>

            

            <div class="resource-card">

                <div class="resource-icon">ü™µ</div>

                <div class="resource-info">

                    <div class="resource-name">–î–ï–†–ï–í–û</div>

                    <div class="resource-amount" id="wood-count">80</div>

                </div>

            </div>

            

            <div class="resource-card">

                <div class="resource-icon">‚õ∞Ô∏è</div>

                <div class="resource-info">

                    <div class="resource-name">–ö–ê–ú–ï–ù–¨</div>

                    <div class="resource-amount" id="stone-count">60</div>

                </div>

            </div>

        </div>

        

        <div class="buildings-grid">

            <div class="building-card" data-type="castle">

                <span class="building-icon">üè∞</span>

                <div class="building-name">–ó–ê–ú–û–ö</div>

                <div class="building-level">–£—Ä–æ–≤–µ–Ω—å 1</div>

                <div class="building-production">+0.1 –∞–ª–º–∞–∑–æ–≤/—á–∞—Å</div>

            </div>

            

            <div class="building-card" data-type="farm">

                <span class="building-icon">üåæ</span>

                <div class="building-name">–§–ï–†–ú–ê</div>

                <div class="building-level">–£—Ä–æ–≤–µ–Ω—å 1</div>

                <div class="building-production">+5 –µ–¥—ã/—á–∞—Å</div>

            </div>

            

            <div class="building-card" data-type="sawmill">

                <span class="building-icon">ü™µ</span>

                <div class="building-name">–õ–ï–°–û–ü–ò–õ–ö–ê</div>

                <div class="building-level">–£—Ä–æ–≤–µ–Ω—å 1</div>

                <div class="building-production">+3 –¥–µ—Ä–µ–≤–∞/—á–∞—Å</div>

            </div>

            

            <div class="building-card" data-type="mine">

                <span class="building-icon">‚õèÔ∏è</span>

                <div class="building-name">–®–ê–•–¢–ê</div>

                <div class="building-level">–£—Ä–æ–≤–µ–Ω—å 1</div>

                <div class="building-production">+2 –∫–∞–º–Ω—è/—á–∞—Å</div>

            </div>

        </div>

        

        <div class="timer-status" id="timerStatus">

            ‚è≥ –î–æ —Å–±–æ—Ä–∞: <span id="timer">12:00:00</span>

        </div>

        

        <div class="collection-info">

            üí° –ú–æ–∂–Ω–æ —Å–æ–±–∏—Ä–∞—Ç—å —Ä–µ—Å—É—Ä—Å—ã –∫–∞–∂–¥—ã–µ 12 —á–∞—Å–æ–≤

        </div>

        

        <div class="actions-bar">

            <button class="action-btn" id="collectBtn" onclick="collectResources()">

                <span class="btn-icon">üéÅ</span>

                <span>–°–û–ë–†–ê–¢–¨</span>

            </button>

            

            <button class="action-btn" onclick="showReferralPopup()">

                <span class="btn-icon">üë•</span>

                <span>–ü–†–ò–ì–õ–ê–°–ò–¢–¨</span>

            </button>

            

            <button class="action-btn" onclick="showUpgradeMenu()">

                <span class="btn-icon">‚ö°</span>

                <span>–£–õ–£–ß–®–ò–¢–¨</span>

            </button>

            

            <button class="action-btn" onclick="showStats()">

                <span class="btn-icon">üìä</span>

                <span>–°–¢–ê–¢–ò–°–¢–ò–ö–ê</span>

            </button>

        </div>

        

        <div class="status-bar">

            üëë –ò–≥—Ä–æ–∫: <span id="player-name">–ì–æ—Å—Ç—å</span> | üë• –†–µ—Ñ–µ—Ä–∞–ª–æ–≤: <span id="referrals-count">0</span>

        </div>

    </div>



    <div class="overlay" id="overlay" onclick="hideMenus()"></div>

    

    <div class="upgrade-menu" id="upgradeMenu">

        <h3>‚ö° –£–ª—É—á—à–µ–Ω–∏–µ –∑–¥–∞–Ω–∏–π</h3>

        <div id="upgrade-options"></div>

        <button onclick="hideMenus()" style="margin-top: 15px; width: 100%">–ó–∞–∫—Ä—ã—Ç—å</button>

    </div>



    <script>

        const tg = window.Telegram.WebApp;

        let userData = null;

        

        function initGame() {

            tg.expand();

            tg.MainButton.setText("–ó–ê–ö–†–´–¢–¨");

            tg.MainButton.show();

            tg.MainButton.onClick(() => tg.close());

            

            loadUserData();

            setInterval(updateTimer, 1000);

        }

        

        async function loadUserData() {

            try {

                tg.sendData(JSON.stringify({action: 'get_user_data'}));

            } catch (error) {

                console.error("Error loading user data:", error);

            }

        }

        

        function updateTimer() {

            if (!userData || !userData.last_collection) return;

            

            const lastCollection = new Date(userData.last_collection);

            const now = new Date();

            const timePassed = now - lastCollection;

            const timeLeft = 12 * 60 * 60 * 1000 - timePassed;

            

            const timerElement = document.getElementById('timer');

            const timerStatus = document.getElementById('timerStatus');

            const collectBtn = document.getElementById('collectBtn');

            

            if (timeLeft <= 0) {

                timerElement.textContent = "00:00:00";

                timerStatus.innerHTML = "‚úÖ –†–µ—Å—É—Ä—Å—ã –≥–æ—Ç–æ–≤—ã –∫ —Å–±–æ—Ä—É!";

                timerStatus.className = "timer-status ready";

                collectBtn.disabled = false;

            } else {

                const hours = Math.floor(timeLeft / (1000 * 60 * 60));

                const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));

                const seconds = Math.floor((timeLeft % (60000)) / 1000);

                

                timerElement.textContent = 

                    `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;

                

                timerStatus.innerHTML = `‚è≥ –î–æ —Å–±–æ—Ä–∞: <span id="timer">${timerElement.textContent}</span>`;

                timerStatus.className = "timer-status";

                collectBtn.disabled = true;

            }

        }

        

        async function collectResources() {

            try {

                tg.sendData(JSON.stringify({action: 'collect_resources'}));

            } catch (error) {

                console.error("Error collecting resources:", error);

                tg.showAlert("–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–±–æ—Ä–µ —Ä–µ—Å—É—Ä—Å–æ–≤. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.");

            }

        }

        

        function showReferralPopup() {

            const referralLink = `https://t.me/CastleOnTON_bot?start=ref_${tg.initDataUnsafe.user.id}`;

            

            tg.showPopup({

                title: "üë• –ü—Ä–∏–≥–ª–∞—Å–∏—Ç—å –¥—Ä—É–∑–µ–π",

                message: `–í–∞—à–∞ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞:\n${referralLink}\n\n–ó–∞ –∫–∞–∂–¥–æ–≥–æ –¥—Ä—É–≥–∞ –≤—ã –ø–æ–ª—É—á–∞–µ—Ç–µ 1% –æ—Ç –µ–≥–æ –¥–æ–±—ã—á–∏!`,

                buttons: [{

                    type: 'default',

                    text: '–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É',

                    id: 'copy'

                }, {

                    type: 'cancel'

                }]

            }, function(buttonId) {

                if (buttonId === 'copy') {

                    navigator.clipboard.writeText(referralLink).then(() => {

                        tg.showAlert("–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!");

                    });

                }

            });

        }

        

        function showUpgradeMenu() {

            document.getElementById('upgradeMenu').style.display = 'block';

            document.getElementById('overlay').style.display = 'block';

            

            // –ó–∞–ø–æ–ª–Ω—è–µ–º –æ–ø—Ü–∏–∏ —É–ª—É—á—à–µ–Ω–∏–π

            const upgradeOptions = document.getElementById('upgrade-options');

            upgradeOptions.innerHTML = `

                <div class="upgrade-option">

                    <div>üè∞ –ó–∞–º–æ–∫</div>

                    <div>–£—Ä–æ–≤–µ–Ω—å ${userData.castle_level}</div>

                    <button onclick="upgradeBuilding('castle')">–£–ª—É—á—à–∏—Ç—å (100 üíé)</button>

                </div>

                <div class="upgrade-option">

                    <div>üåæ –§–µ—Ä–º–∞</div>

                    <div>–£—Ä–æ–≤–µ–Ω—å ${userData.farm_level}</div>

                    <button onclick="upgradeBuilding('farm')">–£–ª—É—á—à–∏—Ç—å (80 üíé)</button>

                </div>

                <div class="upgrade-option">

                    <div>ü™µ –õ–µ—Å–æ–ø–∏–ª–∫–∞</div>

                    <div>–£—Ä–æ–≤–µ–Ω—å ${userData.sawmill_level}</div>

                    <button onclick="upgradeBuilding('sawmill')">–£–ª—É—á—à–∏—Ç—å (90 üíé)</button>

                </div>

                <div class="upgrade-option">

                    <div>‚õèÔ∏è –®–∞—Ö—Ç–∞</div>

                    <div>–£—Ä–æ–≤–µ–Ω—å ${userData.mine_level}</div>

                    <button onclick="upgradeBuilding('mine')">–£–ª—É—á—à–∏—Ç—å (70 üíé)</button>

                </div>

            `;

        }

        

        function hideMenus() {

            document.getElementById('upgradeMenu').style.display = 'none';

            document.getElementById('overlay').style.display = 'none';

        }

        

        function showStats() {

            if (!userData) return;

            

            tg.showPopup({

                title: "üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏–≥—Ä–æ–∫–∞",

                message: `üíé –ê–ª–º–∞–∑—ã: ${userData.gems}\nüåæ –ï–¥–∞: ${userData.food}\nü™µ –î–µ—Ä–µ–≤–æ: ${userData.wood}\n‚õ∞Ô∏è –ö–∞–º–µ–Ω—å: ${userData.stone}\n\nüè∞ –ó–∞–º–æ–∫: –£—Ä. ${userData.castle_level}\nüåæ –§–µ—Ä–º–∞: –£—Ä. ${userData.farm_level}\nü™µ –õ–µ—Å–æ–ø–∏–ª–∫–∞: –£—Ä. ${userData.sawmill_level}\n‚õèÔ∏è –®–∞—Ö—Ç–∞: –£—Ä. ${userData.mine_level}`,

                buttons: [{ type: "ok" }]

            });

        }

        

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–æ–±—â–µ–Ω–∏–π –æ—Ç –±–æ—Ç–∞

        tg.onEvent('message', (message) => {

            try {

                const data = JSON.parse(message);

                if (data.type === 'user_data') {

                    userData = data.data;

                    updateResourcesDisplay();

                    updateTimer();

                }

            } catch (error) {

                console.error("Error parsing message:", error);

            }

        });

        

        function updateResourcesDisplay() {

            if (!userData) return;

            

            document.getElementById('gems-count').textContent = userData.gems.toFixed(1);

            document.getElementById('food-count').textContent = userData.food;

            document.getElementById('wood-count').textContent = userData.wood;

            document.getElementById('stone-count').textContent = userData.stone;

            document.getElementById('referrals-count').textContent = userData.referrals_count;

            

            // –û–±–Ω–æ–≤–ª—è–µ–º —É—Ä–æ–≤–Ω–∏ –∑–¥–∞–Ω–∏–π

            document.querySelector('[data-type="castle"] .building-level').textContent = `–£—Ä–æ–≤–µ–Ω—å ${userData.castle_level}`;

            document.querySelector('[data-type="farm"] .building-level').textContent = `–£—Ä–æ–≤–µ–Ω—å ${userData.farm_level}`;

            document.querySelector('[data-type="sawmill"] .building-level').textContent = `–£—Ä–æ–≤–µ–Ω—å ${userData.sawmill_level}`;

            document.querySelector('[data-type="mine"] .building-level').textContent = `–£—Ä–æ–≤–µ–Ω—å ${userData.mine_level}`;

        }

        

        document.addEventListener('DOMContentLoaded', initGame);

    </script>

</body>

</html>
