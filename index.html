<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Castle Empire</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 100%;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            margin-bottom: 25px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
        }
        
        .game-title {
            font-size: 28px;
            font-weight: bold;
            color: #ff9d00;
            margin-bottom: 5px;
        }
        
        .resources {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 25px;
        }
        
        .resource {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 12px;
            display: flex;
            align-items: center;
        }
        
        .resource-icon {
            font-size: 28px;
            margin-right: 15px;
        }
        
        .resource-info {
            flex-grow: 1;
        }
        
        .resource-name {
            font-size: 14px;
            opacity: 0.8;
            margin-bottom: 5px;
        }
        
        .resource-amount {
            font-size: 20px;
            font-weight: bold;
        }
        
        .timer {
            text-align: center;
            padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            margin-bottom: 20px;
            font-weight: bold;
            font-size: 18px;
        }
        
        .timer.ready {
            background: rgba(76, 175, 80, 0.3);
        }
        
        .actions {
            display: grid;
            gap: 12px;
        }
        
        .btn {
            background: linear-gradient(135deg, #ff9d00 0%, #ff7800 100%);
            color: white;
            border: none;
            padding: 16px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .btn-icon {
            font-size: 20px;
        }
        
        .status {
            text-align: center;
            margin-top: 20px;
            padding: 12px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="game-title">üè∞ Castle Empire</div>
            <div>–†–∞–∑–≤–∏–≤–∞–π —Å–≤–æ–µ –∫–æ—Ä–æ–ª–µ–≤—Å—Ç–≤–æ!</div>
        </div>
        
        <div class="resources">
            <div class="resource">
                <div class="resource-icon">üíé</div>
                <div class="resource-info">
                    <div class="resource-name">–ê–õ–ú–ê–ó–´</div>
                    <div class="resource-amount" id="gems-count">5.0</div>
                </div>
            </div>
            
            <div class="resource">
                <div class="resource-icon">üåæ</div>
                <div class="resource-info">
                    <div class="resource-name">–ï–î–ê</div>
                    <div class="resource-amount" id="food-count">120</div>
                </div>
            </div>
            
            <div class="resource">
                <div class="resource-icon">ü™µ</div>
                <div class="resource-info">
                    <div class="resource-name">–î–ï–†–ï–í–û</div>
                    <div class="resource-amount" id="wood-count">80</div>
                </div>
            </div>
            
            <div class="resource">
                <div class="resource-icon">‚õ∞Ô∏è</div>
                <div class="resource-info">
                    <div class="resource-name">–ö–ê–ú–ï–ù–¨</div>
                    <div class="resource-amount" id="stone-count">60</div>
                </div>
            </div>
        </div>
        
        <div class="timer" id="timer">
            ‚è≥ –î–æ —Å–±–æ—Ä–∞: 04:00:00
        </div>
        
        <div class="actions">
            <button class="btn" id="collect-btn" onclick="collectResources()">
                <span class="btn-icon">üéÅ</span>
                –°–û–ë–†–ê–¢–¨ –†–ï–°–£–†–°–´
            </button>
            
            <button class="btn" onclick="showReferral()">
                <span class="btn-icon">üë•</span>
                –ü–†–ò–ì–õ–ê–°–ò–¢–¨ –î–†–£–ó–ï–ô
            </button>
            
            <button class="btn" onclick="showStats()">
                <span class="btn-icon">üìä</span>
                –°–¢–ê–¢–ò–°–¢–ò–ö–ê
            </button>
        </div>
        
        <div class="status">
            üëë –ò–≥—Ä–æ–∫: <span id="player-name">–ì–æ—Å—Ç—å</span> | üë• –†–µ—Ñ–µ—Ä–∞–ª–æ–≤: <span id="referrals-count">0</span>
        </div>
    </div>

    <script>
        // –î–∞–Ω–Ω—ã–µ –∏–≥—Ä–æ–∫–∞ (–≤ —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –±—É–¥—É—Ç –ø–æ–ª—É—á–∞—Ç—å—Å—è –æ—Ç –±–æ—Ç–∞)
        let userData = {
            gems: 5.0,
            food: 120,
            wood: 80,
            stone: 60,
            last_collection: Math.floor(Date.now() / 1000) - 8 * 3600, // 8 —á–∞—Å–æ–≤ –Ω–∞–∑–∞–¥
            referrals_count: 0
        };
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram WebApp
        const tg = window.Telegram.WebApp;
        
        // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
        function updateUI() {
            document.getElementById('gems-count').textContent = userData.gems.toFixed(1);
            document.getElementById('food-count').textContent = userData.food;
            document.getElementById('wood-count').textContent = userData.wood;
            document.getElementById('stone-count').textContent = userData.stone;
            document.getElementById('referrals-count').textContent = userData.referrals_count;
            
            if (tg.initDataUnsafe && tg.initDataUnsafe.user) {
                document.getElementById('player-name').textContent = tg.initDataUnsafe.user.first_name;
            }
            
            updateTimer();
        }
        
        // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç–∞–π–º–µ—Ä–∞
        function updateTimer() {
            const now = Math.floor(Date.now() / 1000);
            const timeSinceLast = now - userData.last_collection;
            const timeLeft = 12 * 3600 - timeSinceLast;
            
            const timerElement = document.getElementById('timer');
            const collectBtn = document.getElementById('collect-btn');
            
            if (timeLeft <= 0) {
                timerElement.innerHTML = "‚úÖ –†–µ—Å—É—Ä—Å—ã –≥–æ—Ç–æ–≤—ã –∫ —Å–±–æ—Ä—É!";
                timerElement.className = "timer ready";
                collectBtn.disabled = false;
            } else {
                const hours = Math.floor(timeLeft / 3600);
                const minutes = Math.floor((timeLeft % 3600) / 60);
                const seconds = timeLeft % 60;
                
                timerElement.innerHTML = `‚è≥ –î–æ —Å–±–æ—Ä–∞: ${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                timerElement.className = "timer";
                collectBtn.disabled = true;
            }
        }
        
        // –§—É–Ω–∫—Ü–∏—è —Å–±–æ—Ä–∞ —Ä–µ—Å—É—Ä—Å–æ–≤
        function collectResources() {
            const now = Math.floor(Date.now() / 1000);
            const timeSinceLast = now - userData.last_collection;
            
            if (timeSinceLast >= 12 * 3600) {
                // –î–æ–±–∞–≤–ª—è–µ–º —Ä–µ—Å—É—Ä—Å—ã
                userData.gems += 2.0;
                userData.food += 60;
                userData.wood += 40;
                userData.stone += 30;
                userData.last_collection = now;
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
                updateUI();
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
                if (tg.showPopup) {
                    tg.showPopup({
                        title: "‚úÖ –†–µ—Å—É—Ä—Å—ã —Å–æ–±—Ä–∞–Ω—ã!",
                        message: "–í—ã –ø–æ–ª—É—á–∏–ª–∏: üíé2.0, üåæ60, ü™µ40, ‚õ∞Ô∏è30",
                        buttons: [{ type: "ok" }]
                    });
                } else {
                    alert("–†–µ—Å—É—Ä—Å—ã —Å–æ–±—Ä–∞–Ω—ã! –í—ã –ø–æ–ª—É—á–∏–ª–∏: üíé2.0, üåæ60, ü™µ40, ‚õ∞Ô∏è30");
                }
            } else {
                const hoursLeft = Math.floor((12 * 3600 - timeSinceLast) / 3600);
                if (tg.showAlert) {
                    tg.showAlert(`–†–µ—Å—É—Ä—Å—ã –±—É–¥—É—Ç –≥–æ—Ç–æ–≤—ã —á–µ—Ä–µ–∑ ${hoursLeft} —á–∞—Å–æ–≤`);
                } else {
                    alert(`–†–µ—Å—É—Ä—Å—ã –±—É–¥—É—Ç –≥–æ—Ç–æ–≤—ã —á–µ—Ä–µ–∑ ${hoursLeft} —á–∞—Å–æ–≤`);
                }
            }
        }
        
        // –§—É–Ω–∫—Ü–∏—è –ø–æ–∫–∞–∑–∞ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π —Å—Å—ã–ª–∫–∏
        function showReferral() {
            const userId = tg.initDataUnsafe && tg.initDataUnsafe.user ? tg.initDataUnsafe.user.id : 12345;
            const referralLink = `https://t.me/CastleEmpireBot?start=ref_${userId}`;
            
            if (tg.showPopup) {
                tg.showPopup({
                    title: "üë• –ü—Ä–∏–≥–ª–∞—Å–∏—Ç–µ –¥—Ä—É–∑–µ–π",
                    message: `–í–∞—à–∞ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞: ${referralLink}\n\n–ó–∞ –∫–∞–∂–¥–æ–≥–æ –¥—Ä—É–≥–∞ –≤—ã –ø–æ–ª—É—á–∞–µ—Ç–µ –±–æ–Ω—É—Å—ã!`,
                    buttons: [{ type: "ok" }]
                });
            } else {
                alert(`–í–∞—à–∞ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞: ${referralLink}\n\n–ó–∞ –∫–∞–∂–¥–æ–≥–æ –¥—Ä—É–≥–∞ –≤—ã –ø–æ–ª—É—á–∞–µ—Ç–µ –±–æ–Ω—É—Å—ã!`);
            }
        }
        
        // –§—É–Ω–∫—Ü–∏—è –ø–æ–∫–∞–∑–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        function showStats() {
            const now = Math.floor(Date.now() / 1000);
            const timeSinceLast = now - userData.last_collection;
            const timeLeft = 12 * 3600 - timeSinceLast;
            const hoursLeft = Math.floor(timeLeft / 3600);
            const minutesLeft = Math.floor((timeLeft % 3600) / 60);
            
            const statsMessage = `–í–∞—à–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:
üíé –ê–ª–º–∞–∑—ã: ${userData.gems.toFixed(1)}
üåæ –ï–¥–∞: ${userData.food}
ü™µ –î–µ—Ä–µ–≤–æ: ${userData.wood}
‚õ∞Ô∏è –ö–∞–º–µ–Ω—å: ${userData.stone}

‚è∞ –î–æ —Å–±–æ—Ä–∞: ${hoursLeft}—á ${minutesLeft}–º
üë• –†–µ—Ñ–µ—Ä–∞–ª–æ–≤: ${userData.referrals_count}`;

            if (tg.showPopup) {
                tg.showPopup({
                    title: "üìä –í–∞—à–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞",
                    message: statsMessage,
                    buttons: [{ type: "ok" }]
                });
            } else {
                alert(statsMessage);
            }
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', function() {
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º Telegram WebApp
            if (tg && tg.expand) {
                tg.expand();
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
            updateUI();
            
            // –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–∞–π–º–µ—Ä
            setInterval(updateTimer, 1000);
        });
    </script>
</body>
    </html>
